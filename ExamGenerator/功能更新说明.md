# 🎉 功能更新说明

## 新增功能

### 1. ✅ 题干图片插入功能

#### 功能描述
- 支持为每道题目的题干添加图片
- 图片会自动保存到 `static` 目录
- 在生成的HTML中自动显示图片

#### 使用方法
1. 在题目编辑区域，找到"**题干图片**"输入框
2. 点击"**浏览**"按钮选择图片文件
3. 支持的图片格式：`.jpg`, `.png`, `.jpeg`, `.gif`, `.bmp`
4. 添加题目后，图片会在生成试卷时自动复制到输出目录的 `static` 文件夹

#### 图片显示效果
```html
<div class="row" style="margin-top: 10px;">
    <div class="col-md-6">
        <img class="img-responsive center-block" src="./static/question_01.png" alt="题干图片">
    </div>
</div>
```

#### 命名规则
- 题干图片命名格式：`question_XX.扩展名`（XX为题号，如 01, 02...）
- 自动保存位置：`输出目录/static/question_XX.扩展名`

#### 适用题型
- ✅ 单选题
- ✅ 选择填空题
- ✅ 文件操作题（C语言、PS等）

---

### 2. ✅ 优化填空题备选项显示

#### 改进内容
**移除了填空题备选项的"复制代码"按钮**

#### 修改前
```html
<div class="row" style="margin-top: 10px;">
    <div class="col-md-4">
        <pre id="code-2">备选项内容</pre>
    </div>
</div>
<div class="row" style="padding-left: 10px;">
    <button class="btn btn-primary btn-sm btncopy" 
            data-clipboard-target="#code-2">复制代码</button>  ← ❌ 不需要
</div>
```

#### 修改后
```html
<div class="row disable-selected" style="margin-top: 10px;">
    <div class="col-md-12">
        <pre>备选项内容</pre>  ← ✅ 简洁显示，无复制按钮
    </div>
</div>
```

#### 改进理由
1. **备选项是选择项**，不是需要复制的代码
2. **防止误操作**，避免考生直接复制备选项
3. **界面更简洁**，减少不必要的按钮
4. **主代码区域仍保留复制按钮**，方便复制题目代码

---

## 技术实现细节

### 题干图片处理流程

```python
# 1. 用户选择图片
self.question_image.set("/path/to/image.png")

# 2. 添加题目时保存图片路径
question = {
    'question_image': self.question_image.get().strip()
}

# 3. 生成试卷时处理图片
if question_image_path and Path(question_image_path).exists():
    # 复制图片到static目录
    img_name = f"question_{i:02d}{img_ext}"
    shutil.copy2(question_image_path, static_dst / img_name)
    
    # 在题干中添加图片HTML
    question_text_with_img = q['text'] + f'''
    <div class="row" style="margin-top: 10px;">
        <div class="col-md-6">
            <img class="img-responsive center-block" 
                 src="./static/{img_name}" alt="题干图片">
        </div>
    </div>'''
```

### 填空题模板修改

```python
# html_template.py 中的修改
def generate_fill_blank(self, number, question_text, code, choice_options):
    # 备选项区域 - 移除复制按钮
    body = f"""
    <!-- 备选项区域 -->
    <div class="row disable-selected" style="margin-top: 20px;">
        <div class="col-md-12">
        备选项如下：
        </div>
    </div>
    <div class="row disable-selected" style="margin-top: 10px;">
        <div class="col-md-12">
            <pre>{choice_escaped}</pre>
        </div>
    </div>
    """
    # 注意：没有复制按钮！
```

---

## 界面变化

### 新增的界面元素

```
┌─────────────────────────────────────────────┐
│ 题目编辑                                     │
├─────────────────────────────────────────────┤
│ 题目编号: [01___]                            │
│                                              │
│ 题干内容:                                     │
│ ┌─────────────────────────────────────────┐ │
│ │ 输入题干内容...                          │ │
│ └─────────────────────────────────────────┘ │
│                                              │
│ 题干图片: [________________] [浏览] ← 新增！  │
│           （可选）图片将保存到static目录       │
│                                              │
│ ┌─────────────────────────────────────────┐ │
│ │ 选项设置                                 │ │
│ └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────┘
```

---

## 使用示例

### 示例 1：单选题添加图片

1. **填写题目信息**
   - 题目编号：`1`
   - 题干内容：`请根据下图选择正确的答案：`
   - 题干图片：点击"浏览"选择图片文件

2. **填写选项**
   - A: `选项A`
   - B: `选项B`
   - C: `选项C`
   - D: `选项D`

3. **生成结果**
   - HTML文件：`01.html`
   - 图片文件：`static/question_01.png`
   - 图片显示在题干下方

### 示例 2：填空题使用优化的备选项

1. **填写题目信息**
   - 题目编号：`2`
   - 题干内容：`填空题说明`
   - 填空数量：`5`
   - 每空分值：`2`

2. **填写主代码**
   ```c
   int main() {
       // 填空位置
       return 0;
   }
   ```

3. **填写备选项**
   ```
   A、printf()
   B、scanf()
   C、return
   D、void
   ```

4. **生成结果**
   - 主代码区域：有"复制代码"按钮 ✅
   - 备选项区域：无复制按钮 ✅（优化）

---

## 兼容性说明

### 向后兼容
- ✅ 旧项目文件（.json）可以正常加载
- ✅ 没有题干图片的题目正常显示
- ✅ `question_image` 字段为空时不影响生成

### 导入现有试卷
- 导入时 `question_image` 字段默认为空字符串
- 需要手动重新添加题干图片（如果需要）

---

## 注意事项

### 题干图片
1. **图片大小**：建议使用适当大小的图片（宽度不超过800px）
2. **图片格式**：推荐使用 `.png` 或 `.jpg` 格式
3. **路径保存**：图片路径会保存在项目文件中，移动项目前需注意
4. **自动复制**：生成试卷时会自动复制图片，无需手动复制

### 填空题备选项
1. **复制代码**：只有主代码区域有复制按钮
2. **备选项**：纯文本显示，不可复制（通过 `disable-selected` 类实现）
3. **格式建议**：备选项建议使用 `A、B、C` 的格式
4. **宽度调整**：备选项从 `col-md-4` 改为 `col-md-12`，占据更多空间

---

## 文件修改清单

### 修改的文件

1. **exam_generator.py**
   - ✅ 添加题干图片输入框（第104-112行）
   - ✅ 添加 `browse_question_image()` 方法
   - ✅ 在 `add_question()` 中保存图片路径
   - ✅ 在 `update_question()` 中更新图片路径
   - ✅ 在 `on_question_select()` 中加载图片路径
   - ✅ 在 `clear_form()` 中清空图片路径
   - ✅ 在 `generate_exam()` 中处理图片复制和HTML生成

2. **html_template.py**
   - ✅ 修改 `generate_fill_blank()` 方法
   - ✅ 移除备选项的复制按钮
   - ✅ 调整备选项的CSS类（添加 `disable-selected`）
   - ✅ 调整备选项的列宽（`col-md-4` → `col-md-12`）

---

## 测试建议

### 测试场景

#### 场景 1：单选题带图片
- [ ] 添加带图片的单选题
- [ ] 生成试卷，检查图片是否正确显示
- [ ] 验证图片路径正确（`./static/question_XX.扩展名`）

#### 场景 2：填空题无复制按钮
- [ ] 添加填空题
- [ ] 生成试卷，检查备选项区域
- [ ] 验证主代码有复制按钮
- [ ] 验证备选项没有复制按钮

#### 场景 3：保存和加载项目
- [ ] 添加带图片的题目
- [ ] 保存项目为 .json 文件
- [ ] 加载项目，检查图片路径是否正确

#### 场景 4：兼容性测试
- [ ] 加载旧版本的项目文件
- [ ] 验证不带图片的题目正常工作
- [ ] 为旧题目添加图片

---

## 总结

### ✅ 已完成
1. **题干图片插入功能** - 完整实现，支持所有题型
2. **填空题备选项优化** - 移除不必要的复制按钮
3. **向后兼容** - 不影响现有功能和旧项目

### 🎯 优势
1. **用户友好** - 简单直观的图片上传界面
2. **自动化处理** - 图片自动复制和重命名
3. **界面简洁** - 移除冗余按钮，提升体验

### 🚀 建议
1. 定期清理 `static` 目录中的旧图片
2. 使用合适大小的图片以提高加载速度
3. 保存项目时注意图片路径的有效性
