<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{title}</title>
    <link rel="stylesheet" href="./static/bootstrap.min.css">
    <link rel="stylesheet" href="./static/toastify.css">
    <link rel="stylesheet" href="./static/viewer.min.css">
    <style>
                /* 禁止文本选择 */
                .disable-selected {
                        -webkit-user-select: none; /* Safari */
                        -moz-user-select: none; /* Firefox */
                        -ms-user-select: none; /* IE/Edge */
                        user-select: none; /* 标准语法 */
                }
                /* 全屏水印相关样式 */
                @layer utilities {
            .watermark-container {
                /* @apply fixed inset-0 pointer-events-none z-50 overflow-hidden; */
                                position: fixed;
                                top: 0;
                                right: 0;
                                bottom: 0;
                                left: 0;
                                pointer-events: none;
                                z-index: 9999;
                                overflow: hidden;
            }
        }
    </style>
  </head>
  <body>
        <div class="container-fluid" style="margin: 10px;">
                <!-- 题干区域 -->
                <div class="row disable-selected">
                        <div class="col-md-12" id="question-stem">
                        {prompt_html}
                        </div>
                </div>
                <!-- 选项容器 -->
                <div id="option-container"></div>
        </div>
        <!-- 水印容器 -->
    <div id="watermarkContainer" class="watermark-container"></div>
    <script src="./static/jquery.min.js"></script>
    <script src="./static/clipboard.min.js"></script>
    <script src="./static/bootstrap.min.js"></script>
    <script src="./static/toastify.js"></script>
    <script src="./static/viewer.min.js"></script>
    <script src="./static/jquery-viewer.min.js"></script>
    <script>
                var ShowWatermark = false; // 是否显示水印
                // 水印配置
        var watermarkConfig = null;
                // 创建水印
        function createWatermark() {
            // 清空现有水印
            watermarkContainer.innerHTML = '';

            // 获取视口尺寸
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            // 计算水印数量
            const cols = Math.ceil(viewportWidth / watermarkConfig.spacing) + 1;
            const rows = Math.ceil(viewportHeight / watermarkConfig.spacing) + 1;

            // 创建水印元素
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const watermark = document.createElement('div');

                    // 设置水印样式
                    watermark.style.position = 'absolute';
                    watermark.style.left = `${j * watermarkConfig.spacing}px`;
                    watermark.style.top = `${i * watermarkConfig.spacing}px`;
                    watermark.style.transform = `rotate(${watermarkConfig.rotation}deg)`;
                    watermark.style.opacity = watermarkConfig.opacity;
                    watermark.style.fontSize = `${watermarkConfig.fontSize}px`;
                    watermark.style.color = watermarkConfig.color;
                    watermark.style.fontFamily = 'Arial, sans-serif';
                    watermark.style.whiteSpace = 'nowrap';
                    watermark.style.userSelect = 'none';
                    watermark.style.webkitUserSelect = 'none';
                    watermark.style.zIndex = '100';

                    // 设置水印文本
                    watermark.textContent = watermarkConfig.text;

                    // 添加到容器
                    watermarkContainer.appendChild(watermark);
                }
            }
        }
        // 生成选项
        const options = {options_json};
        const container = document.getElementById('option-container');
        options.forEach((text, index) => {
            const letter = String.fromCharCode('A'.charCodeAt(0) + index);
            const row = document.createElement('div');
            row.className = 'row disable-selected';
            row.style.marginTop = '10px';

            const col = document.createElement('div');
            col.className = 'col-md-12';

            const radioWrapper = document.createElement('div');
            radioWrapper.className = 'radio';

            const label = document.createElement('label');

            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'options';
            input.id = 'option' + letter;
            input.value = letter;

            const mark = document.createElement('span');
            mark.className = 'disable-selected';
            mark.style.fontWeight = 'bold';
            mark.style.marginRight = '5px';
            mark.textContent = letter + '.';

            const textSpan = document.createElement('span');
            textSpan.textContent = text;

            label.appendChild(input);
            label.appendChild(mark);
            label.appendChild(textSpan);

            radioWrapper.appendChild(label);
            col.appendChild(radioWrapper);
            row.appendChild(col);
            container.appendChild(row);
        });
        // 网页加载就绪
                $(document).ready(function() {
                        // AppBridge（不要动）
                        if (typeof CefSharp !== 'undefined' && CefSharp.BindObjectAsync) {
                                CefSharp.BindObjectAsync("AppBridge");
                        }
                        // 实现复制代码功能
                        var clipboard = new ClipboardJS('.btncopy');
                        clipboard.on('success', function(e) {
                                e.clearSelection();
                                Toastify({
                                        text: "复制成功"
                                }).showToast();
                        });
                        // 接收来自宿主程序的答案
                        window.answer = function(option) {
                                switch(option)
                                {
                                        case "A":
                                        case "B":
                                        case "C":
                                        case "D":
                                        case "E":
                                        case "F":
                                        case "G":
                                        case "H":
                                        case "I":
                                        case "J":
                                                $('#option' + option).attr('checked', 'true');
                                }
                        };
                        // 接收来自宿主程序的水印
                        window.watermark = function(text) {
                                if(ShowWatermark) {
                                        watermarkConfig = {
                                                text: text,
                                                rotation: -30,       // 旋转角度
                                                opacity: 0.05,        // 透明度
                                                fontSize: 20,        // 字体大小(px)
                                                spacing: 200,        // 水印间距(px)
                                                color: '#000000'     // 水印颜色
                                        };
                                        createWatermark(); // 初始化水印
                                }
                        }
                        // 禁止右键菜单
                        document.addEventListener('contextmenu', function(e) {
                                e.preventDefault();
                                return false;
                        });
                        // 监听选项变化
                        $('input[type="radio"][name="options"]').change(function() {
                                var selectedValue = $(this).val();
                                if (typeof AppBridge !== 'undefined' && AppBridge.submit) {
                                        // 向宿主程序提交答案
                                        AppBridge.submit(selectedValue);
                                } else {
                                        Toastify({
                                                text: "无法向宿主程序同步答案！"
                                        }).showToast();
                                }
                        });
                        // 图片放大
                        var $image = $('#preview');
                        $image.viewer({
                                inline: true,
                                viewed: function() {
                                        $image.viewer('zoomTo', 1);
                                }
                        });
                        // Get the Viewer.js instance after initialized
                        var viewer = $image.data('viewer');
                        // View a list of images
                        $('.zoom').viewer();
                });
    </script>
  </body>
</html>
